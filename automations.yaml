#casting
- alias: 'casting'
  trigger:
  - platform: state
    entity_id: media_player.living_room_tv
    to: 'playing'
  action:
  - service: script.turn_on
    entity_id: script.tv_hdmi2
  - delay: '00:00:01'
  - service: script.turn_on
    entity_id: script.denon_tv

#allt av
#- alias: "Allt av"
#  trigger:
#  - platform: time
#    at: '22:10:00'
#  action:
#  - service: scene.turn_on
#    data:
#     entity_id: scene.all_off
- alias: 'important'
  trigger:
    platform: homeassistant
    # Event can also be 'shutdown'
    event: start
  action:
    - service: python_script.count_down_anniversary
    - service: python_script.count_down_engagement
#läggdagslidija vardagar
- alias: 'Bedtime Lidija'
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.fading_time.state }}'
  condition:
  - condition: state
    entity_id: input_boolean.fadelight
    state: 'on'
  - condition: state
    entity_id: input_boolean.alarmweekday_lidija
    state: 'on'
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  action:
  - service: script.turn_on
    entity_id: script.sleep
#######################################
#                                     #
#       Pollen                        #
#                                     #
#######################################
#polleninfo
- alias: 'Polleninfo'
  initial_state: true
  trigger:
  - platform: state
    entity_id: input_boolean.polleninfo
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.morning
- alias: 'Polleninfo tyst'
  initial_state: true
  trigger:
  - platform: state
    entity_id: input_boolean.tyst_polleninfo
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.morning_tyst
#pollenalert
- alias: 'Pollen alert'
  trigger:
  - platform: template
    value_template: "{{ states.sensor.pollen_gras.state in ['M-H','H', 'H+'] or states.sensor.pollen_bjork.state in ['M-H','H', 'H+'] }}"
  action:
  - service: notify.push
    data_template:
      title: Pollen Alert
      message: 'Höga halter av pollen'
#######################################
#                                     #
#       System                        #
#                                     #
#######################################
- alias: Update notifications
  trigger:
    - platform: state
      entity_id: updater.updater
  action:
    service: notify.push
    data_template: 
      title: 'New Home Assistant Release'
      message: "Home Assistant  {{ states.updater.updater.state }}  is now available."
- alias: 'Hass Startup'
  trigger:
    - platform: homeassistant
      event: start
  action:
  - service: python_script.count_down_anniversary
  - service: python_script.count_down_engagement
  - service: group.set_visibility
    entity_id: group.travel_gamlestan
    data:
      visible: True
#######################################
#                                     #
#       Media                         #
#                                     #
#######################################
- alias: 'Play Spotify'
  initial_state: true
  trigger:
  - platform: state
    entity_id: input_boolean.play_spotify
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.play_spotify
#tv/stereo
- alias: "Volume kitchen"
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_kitchen2
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.kitchen
      volume_level: '{{  states.input_number.spotify_volume_kitchen.state  }}'
- alias: "Volume Living room left"
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_lr_l
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_left_2
      volume_level: '{{  states.input_number.spotify_volume_lr_l.state  }}'
- alias: "Volume Living room right"
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_lr_r
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_right
      volume_level: '{{  states.input_number.spotify_volume_lr_r.state  }}'
- alias: "Volume Living room speaker"
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_lr
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_home
      volume_level: '{{  states.input_number.spotify_volume_lr.state  }}'
- alias: "Volume Hallway"
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_hallway
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.hallway
      volume_level: '{{  states.input_number.spotify_volume_hallway.state  }}'
- alias: "Volume Bedroom"
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_bedroom
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.kitchen
      volume_level: '{{  states.input_number.spotify_volume_bedroom.state  }}'   
- alias: "Volume cca"
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_cca
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.chromecast_audio
      volume_level: '{{  states.input_number.spotify_volume_cca.state  }}'
- alias: "Volume All"
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_all
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.kitchen, media_player.living_room_left_2, media_player.living_room_right, media_player.living_room_speaker, media_player.hallway, media_player.chromecast_audio
      volume_level: '{{  states.input_number.spotify_volume_all.state  }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.spotify_volume_kitchen, input_number.spotify_volume_hallway, input_number.spotify_volume_lr, input_number.spotify_volume_lr_r, input_number.spotify_volume_lr_l, input_number.spotify_volume_living_room, input_number.spotify_volume_music, input_number.spotify_volume_cca
      value: "{{states.input_number.spotify_volume_all.state}}"
- alias: "Volume Music"
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_music
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.kitchen, media_player.living_room_left_2, media_player.living_room_right, media_player.living_room_speaker
      volume_level: '{{  states.input_number.spotify_volume_music.state  }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.spotify_volume_kitchen, input_number.spotify_volume_hallway, input_number.spotify_volume_lr, input_number.spotify_volume_lr_r, input_number.spotify_volume_lr_l, input_number.spotify_volume_living_room
      value: "{{states.input_number.spotify_volume_music.state}}"
- alias: "Volume Livingroom"
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_living_room
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_left_2, media_player.living_room_right, media_player.living_room_speaker
      volume_level: '{{  states.input_number.spotify_volume_living_room.state  }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.spotify_volume_lr, input_number.spotify_volume_lr_r, input_number.spotify_volume_lr_l
      value: "{{states.input_number.spotify_volume_living_room.state}}"
#######################################
#                                     #
#       Larm                          #
#                                     #
#######################################
- alias: 'Alarm när vi inte är hemma'
  initial_state: true
  trigger:
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.ha_alarm
    state: armed_away
  - condition: state
    entity_id: device_tracker.lidija_762061a869904b4d98a3f95645299120
    state: not_home
  - condition: state
    entity_id: device_tracker.christer_honor
    state: not_home
  action:
  - service: notify.push
    data_template:
      title: 'Alert'
      message:  'Larmet går! Tjuvar i lägenheten'
#######################################
#                                     #
#       Belysning                     #
#                                     #
#######################################
- alias: 'Reset after power failure'
  trigger:
  - platform: numeric_state
    entity_id: light.bedroom_light
    value_template: '{{ state.attributes.brightness }}'
    above: 253
  action:
  - service: light.turn_on
    data:
      entity_id: light.bedroom_light, light.bedroom_window_light, light.book_shelf_color_two, light.bookshelf_color, light.guest_room_1, light.guest_room_2, light.guest_room_3, light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger, light.kitchen_fan, light.kitchen_fan_2, light.kitchen_sink, light.kitchen_sink_two, light.kitchen_window, light.living_room_right_sofa, light.living_room_window_light, light.onoff_plug_1
      color_temp: 353
      brightness: 1
  - delay:
      seconds: 1
  - service: light.turn_off
    data:
      entity_id: light.bedroom_light, light.bedroom_window_light, light.book_shelf_color_two, light.bookshelf_color, light.guest_room_1, light.guest_room_2, light.guest_room_3, light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger, light.kitchen_fan, light.kitchen_fan_2, light.kitchen_sink, light.kitchen_sink_two, light.kitchen_window, light.living_room_right_sofa, light.living_room_window_light, light.onoff_plug_1
  - service: notify.push
    data_template:
      title: Power failure
      message: 'Strömavbrott'

- alias: "Set livingroom color"
  trigger:
    platform: state
    entity_id: input_select.livingroom
  condition:
    condition: template
    value_template: "{{ states('input_select.livingroom') != 'normal' }}"
  action:
    service: light.turn_on
    data_template:
      entity_id: light.bookshelf_color, light.book_shelf_color_two, light.living_room_window_light
      color_name: "{{ states.input_select.livingroom.state }}"
#######
#vardagsrum fönster
#######
- alias: "lr_w_lamp_bright"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.lr_w_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light
      brightness: '{{ states.input_number.lr_w_lamp_bright.state | int }}'

- alias: "lr_w_lamp_temp"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.lr_w_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light
      color_temp: '{{ states.input_number.lr_w_lamp_temp.state | int }}'

- alias: "lr_w_lamp_white"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.lr_w_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light
      white_value: '{{ states.input_number.lr_w_lamp_white.state | int }}'
#######
#vardagsrummet
#######
- alias: "livingroom_lamp_bright"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.livingroom_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light, light.bookshelf_color, light.book_shelf_color_two
      brightness: '{{ states.input_number.livingroom_lamp_bright.state | int }}'

- alias: "livingroom_lamp_temp"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.livingroom_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light, light.bookshelf_color, light.book_shelf_color_two
      color_temp: '{{ states.input_number.livingroom_lamp_temp.state | int }}'

- alias: "livingroom_lamp_white"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.livingroom_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light, light.bookshelf_color, light.book_shelf_color_two
      white_value: '{{ states.input_number.livingroom_lamp_white.state | int }}'
#######
#vardagsrum bokhylla
#######
- alias: "bookshelf_lamp_bright"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bookshelf_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bookshelf_color, light.book_shelf_color_two
      brightness: '{{ states.input_number.bookshelf_lamp_bright.state | int }}'
- alias: "bookshelf_lamp_temp"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bookshelf_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bookshelf_color, light.book_shelf_color_two
      color_temp: '{{ states.input_number.bookshelf_lamp_temp.state | int }}'
- alias: "bookshelf_lamp_white"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bookshelf_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bookshelf_color, light.book_shelf_color_two
      white_value: '{{ states.input_number.bookshelf_lamp_white.state | int }}'
#######
#köket
#######
- alias: "k_w_lamp_bright"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.k_w_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.kitchen_window
      brightness: '{{ states.input_number.k_w_lamp_bright.state | int }}'
- alias: "k_w_lamp_temp"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.k_w_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.kitchen_window
      color_temp: '{{ states.input_number.k_w_lamp_temp.state | int }}'
- alias: "k_w_lamp_white"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.k_w_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.kitchen_window
      white_value: '{{ states.input_number.k_w_lamp_white.state | int }}'
#######
#hallen
#######
- alias: "hall_lamp_bright"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.hall_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger
      brightness: '{{ states.input_number.hall_lamp_bright.state | int }}'
- alias: "hall_lamp_temp"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.hall_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger
      color_temp: '{{ states.input_number.hall_lamp_temp.state | int }}'
- alias: "hall_lamp_white"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.hall_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger
      white_value: '{{ states.input_number.hall_lamp_white.state | int }}'
#######
#sovrummet fönster
#######
- alias: "bw_lamp_bright"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bw_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_window_light
      brightness: '{{ states.input_number.bw_lamp_bright.state | int }}'
- alias: "bw_lamp_temp"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bw_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_window_light
      color_temp: '{{ states.input_number.bw_lamp_temp.state | int }}'
- alias: "bw_lamp_white"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bw_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_window_light
      white_value: '{{ states.input_number.bw_lamp_white.state | int }}'
#######
#sovrummet
#######
- alias: "bedroom_lamp_bright"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bedroom_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_window_light, light.bedroom_light
      brightness: '{{ states.input_number.bedroom_lamp_bright.state | int }}'

- alias: "bedroom_lamp_temp"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bedroom_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_window_light, light.bedroom_light
      color_temp: '{{ states.input_number.bedroom_lamp_temp.state | int }}'

- alias: "bedroom_lamp_white"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bedroom_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_window_light, light.bedroom_light
      white_value: '{{ states.input_number.bedroom_lamp_white.state | int }}'
#######
#sovrummet vägg
#######

- alias: "bwall_lamp_bright"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bwall_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_light
      brightness: '{{ states.input_number.bwall_lamp_bright.state | int }}'

- alias: "bwall_lamp_temp"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bwall_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_light
      color_temp: '{{ states.input_number.bwall_lamp_temp.state | int }}'

- alias: "bwall_lamp_white"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bwall_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_light
      white_value: '{{ states.input_number.bwall_lamp_white.state | int }}'
- alias: "Fönster"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.window
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light, light.kitchen_window
      brightness: '{{ states.input_number.window.state | int * 2.55 | round(0) }}'
- alias: "Fönster köket dim"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.kitchen_vindow
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.kitchen_window
      brightness: '{{ states.input_number.kitchen_vindow.state | int * 2.55 | round(0) }}'
- alias: "Fönster vardagsrum dim"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.v_rum_vindow
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light
      brightness: '{{ states.input_number.v_rum_vindow.state | int * 2.55 | round(0) }}'
- alias: "Fönster sovrum dim"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.s_rum_vindow
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_window_light
      brightness: '{{ states.input_number.s_rum_vindow.state | int * 2.55 | round(0) }}'
- alias: "Fönster soffbord höger dim"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.v_rum_sofa_r
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_right_sofa
      brightness: '{{ states.input_number.v_rum_sofa_r.state | int * 2.55 | round(0) }}'
- alias: "Fönster soffbord vänster dim"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.v_rum_sofa_l
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.vanster_soffbord
      brightness: '{{ states.input_number.v_rum_sofa_l.state | int * 2.55 | round(0) }}'
- alias: "Vardagsrum dim"
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.v_rum
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light, light.book_shelf_color, light.book_shelf_color_two, light.living_room_right_sofa
      brightness: '{{ states.input_number.v_rum.state | int * 2.55 | round(0) }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.v_rum_sofa_l, input_number.v_rum_sofa_r, input_number.v_rum_vindow
      value: "{{states.input_number.v_rum.state}}"
#skymning
- alias: 'Fönster efter skymning'
  initial_state: true
  trigger:
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: 2.5
#  - platform: sun
#    event: sunset
#    offset: "-0:20:00"
  condition:
  - condition: state
    entity_id: group.all_devices
    state: home
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  action:
  - service: script.turn_on
    entity_id: 
      - script.skymning
#skymning 2
- alias: "skymning 2"
  trigger:
  - platform: time
    at: '19:00:00'
  condition:
  - condition: state
    entity_id: group.all_devices
    state: home
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  action:
  - service: script.turn_on
    data:
     entity_id: script.skymning2
#######################################
#                                     #
#       Släck när vi inte är hemma    #
#                                     #
#######################################
- alias: 'Släck när vi inte är hemma'
  initial_state: true
  trigger:
    platform: state
    entity_id: group.all_devices
    to: not_home
  action:
    - service: homeassistant.turn_off
      entity_id:  light.bedroom, light.dining, light.guest_room, light.hallway, light.kitchen, light.living_room, light.sink
#######################################
#                                     #
#       Kaffe                         # 
#                                     #
#######################################
- alias: 'kitchen plug'
  trigger:
    platform: state
    entity_id: light.kaffe
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.coffee_on
#kaffetimer
- alias: 'Kaffe'
  initial_state: true
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.coffeetime.state }}'
  condition:
  - condition: state
    entity_id: group.all_devices
    state: home
  - condition: state
    entity_id: input_boolean.coffeornot
    state: 'on'
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  action:
  - service: script.turn_on
    entity_id: script.coffee_on
#kaffe off automatic
- alias: Turn off perkulator at end of timer
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_perka
  action:
  - service: script.turn_on
    entity_id: script.coffee_off
#vattenkokare on
- alias: 'Vattenkokare on'
  initial_state: true
  trigger:
  - platform: state
    entity_id: input_boolean.vattenkokare
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.vattenkokare_on
#vattenkokare on
- alias: 'Vattenkokare on'
  initial_state: true
  trigger:
  - platform: state
    entity_id: input_boolean.perka
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.coffee_on
#vattenkokare off automatic
- alias: Turn off vattenkokare at end of timer
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_vattenkokare
  action:
  - service: script.turn_on
    entity_id: script.coffee_off
#######################################
#                                     #
#       Godnatt & Godmorgon           #
#                                     #
#######################################
#######################################
#                                     #
#       Någon kommer hem              #
#                                     #
#######################################
#lidija kom hem
- alias: 'Lidija kom hem'
  trigger:
    platform: state
    entity_id: group.lidija
    from: 'not_home'
    to: 'home'
  action:
  - service: notify.push
    data_template:
      title: Välkommen
      message:  Lidija kom hem {{ states('sensor.time') }}
#######################################
#                                     #
#       Temperatur                    #
#                                     #
#######################################
- alias: 'Kallt i lägenheten'
  trigger:
    platform: numeric_state
    entity_id: sensor.medel_temperatur
    below: 16
  condition:
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  action:
    service: notify.push
    data_template:
      title: Kallt i lägenheten
      message: Nu är det kallt
