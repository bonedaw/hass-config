- alias: 'Automatic Goodnight'
  initial_state: 'on'
  trigger:
    - platform: time
      at: '22:00:00'
  condition:
  - condition: state
    entity_id: input_select.house_mode
    state: 'Away'
  action:
  - service: script.turn_on
    entity_id: script.goodbye3

- alias: Home Mode - Leaving
  trigger:
  - platform: state
    entity_id: binary_sensor.people_home
    to: 'off'
    for:
      seconds: 15
  condition:
  - condition: numeric_state
    entity_id: sensor.ha_runtime_in_minutes
    above: 1
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'   
  action:
  - service: input_select.select_option
    entity_id: input_select.house_mode
    data:
      option: 'Away'

- alias: Home Mode - Arriving
  trigger:
  - platform: state
    entity_id:
      - input_boolean.cg_present
      - input_boolean.lt_present
      - input_boolean.guests_present
    to: 'on'
  - platform: state
    entity_id:
      - device_tracker.christer_samsung_s9
      - device_tracker.honor9lan
#      - device_tracker.tracy_all
#      - device_tracker.tracys_iphone_2
#      - group.extra_device_trackers
    to: 'home'
  condition:
  - condition: numeric_state
    entity_id: sensor.ha_runtime_in_minutes
    above: 1
  - condition: state
    entity_id: input_select.house_mode
    state: 'Away'
  action:
  - service: input_select.select_option
    entity_id: input_select.house_mode
    data:
      option: 'Home'

- alias: Home Lidija - Arriving
  trigger:
  - platform: state
    entity_id:
      - device_tracker.honor9lan
    to: 'home'
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.lt_present

- alias: Home Christer - Arriving
  trigger:
  - platform: state
    entity_id:
      - device_tracker.christer_samsung_s9
    to: 'home'
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.cg_present

- alias: Home Lidija - Arriving
  trigger:
  - platform: state
    entity_id:
      - device_tracker.honor9lan
    to: 'not_home'
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.lt_present

- alias: Home Christer - Arriving
  trigger:
  - platform: state
    entity_id:
      - device_tracker.christer_samsung_s9
    to: 'not_home'
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.cg_present
#######################################
#                                     #
#       System                        #
#                                     #
#######################################

- alias: 'cg_coming_home'
  trigger:
    platform: state
    entity_id: device_tracker.christer_samsung_s9
    to: 'home'
  condition:
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id:  media_player.bedroom
    state: 'off'
  - condition: state
    entity_id: media_player.chromecast_audio
    state: 'off'
  - condition: state
    entity_id: media_player.hallway
    state: 'off'
  - condition: state
    entity_id: media_player.kitchen
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_left
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_display
    state: 'off'
  - condition: state
    entity_id:  media_player.living_room_speaker
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_right
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'
  action:
    - service: notify.push
      data:
        title: 'Home'
        message: 'CG Home'
#  - service: script.turn_on
#    entity_id: script.cg_home



- alias: "xmas_song"
  trigger:
    platform: state
    entity_id: media_player.all,media_player.spa
    to: 'playing'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:4ylXKnf5PQdCcOiXzKGysV" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:3IfnHtJEDnOP7J2qXN9wsi" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:7vQbuQcyTflfCIOu3Uzzya" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:0bYg9bo50gSsH3LtXe2SQn" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:0F2o0i9Qg7lFU9unvIPzvi" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:5a1iz510sv2W9Dt1MvFd5R" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:4ricyQVd20UQde1jpXCSuJ" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:11P4sSu6BH2lAbWk1sL6cK" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:177r7J6bnoMnW4MQx1GQng" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:4ylXKnf5PQdCcOiXzKGysV" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:3IfnHtJEDnOP7J2qXN9wsi" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:7vQbuQcyTflfCIOu3Uzzya" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:0bYg9bo50gSsH3LtXe2SQn" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:0F2o0i9Qg7lFU9unvIPzvi" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:5a1iz510sv2W9Dt1MvFd5R" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:4ricyQVd20UQde1jpXCSuJ" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:11P4sSu6BH2lAbWk1sL6cK" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:177r7J6bnoMnW4MQx1GQng" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "http://christmas.allchristmashitsradio.com:8000/stream/4/" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "http://christmas.allchristmashitsradio.com:8000/stream/4/" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "http://streaming.asliveaudio.net:8000/stream/?sid=1231" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "http://streaming.asliveaudio.net:8000/stream/?sid=1231" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "http://kea.cdnstream.com/1837_128" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "http://kea.cdnstream.com/1837_128" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "http://xmas.cdnstream.com/xmas128" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "http://xmas.cdnstream.com/xmas128" }}'
  action:
    - service: light.turn_on
      data: 
#Living room window
    - service: light.turn_on
      data: 
        entity_id: light.living_room_window_light
        rgb_color: [255,191,88]
        brightness: 220
        transition: 10
#Guest room window
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1_3
        rgb_color: [255,191,88]
        brightness: 220
        transition: 10
#Kitchen window
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1
        rgb_color: [255,0,67]
        brightness: 179
        transition: 10
#Bedroom window
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1_4
        rgb_color: [255,0,67]
        brightness: 179
        transition: 10
#right sofa
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1_2
        rgb_color: [69,255,65]
        brightness: 60
        transition: 10
#Left sofa
    - service: light.turn_on
      data: 
        entity_id: light.hue_go_1
        rgb_color: [255,191,88]
        brightness: 179
        transition: 10
#Bookshelf
    - service: light.turn_on
      data: 
        entity_id: light.bookshelf_color
        rgb_color: [255,43,48]
        brightness: 60
        transition: 10
#Bookshelf
    - service: light.turn_on
      data: 
        entity_id: light.book_shelf_color_two
        rgb_color: [81,255,119]
        brightness: 60
        transition: 10
#Left power
    - service: light.turn_on
      data: 
        entity_id: light.onoff_plug_3

- alias: "pop_song"
  trigger:
    platform: state
    entity_id: media_player.all,media_player.spa
    to: 'playing'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "http://stream.ueteknik.se:8000/poporock" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "http://stream.ueteknik.se:8000/poporock" }}'
  action:
    - service: script.turn_on
      data: 
        entity_id: script.moodlight
#        rgb_color: [255,0,67]
#        brightness: 179
#        transition: 10
#        period: 40
#        cycles: 100
#        mode: breathe
#        effect: colorloop
#Valid modes: blink (default), breathe , ping , strobe , solid .

- alias: 'twinkly_on'
  initial_state: 'on'
  trigger:
    - platform: time
      at: '17:00:00'
  condition:
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'
  action:
    - service: homeassistant.turn_on
      entity_id: switch.twinkly

- alias: 'twinkly_off'
  initial_state: 'on'
  trigger:
  - platform: time
    at: '21:45:00'
  action:
    - service: homeassistant.turn_off
      data: 
        entity_id: switch.twinkly

- alias: 'xmas'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.twinkly
    to: 'on'
  condition:
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'
  action:
#Living room window
    - service: light.turn_on
      data: 
        entity_id: light.living_room_window_light
        rgb_color: [255,191,88]
        brightness: 220
        transition: 10
#Guest room window
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1_3
        rgb_color: [255,191,88]
        brightness: 220
        transition: 10
#Kitchen window
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1
        rgb_color: [255,0,67]
        brightness: 179
        transition: 10
#Bedroom window
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1_4
        rgb_color: [255,0,67]
        brightness: 179
        transition: 10
#right sofa
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1_2
        rgb_color: [255,191,88]
        brightness: 60
        transition: 10
#Left sofa
    - service: light.turn_on
      data: 
        entity_id: light.hue_go_1
        rgb_color: [255,191,88]
        brightness: 179
        transition: 10
#Bookshelf
    - service: light.turn_on
      data: 
        entity_id: light.bookshelf_color
        rgb_color: [255,191,88]
        brightness: 60
        transition: 10
#Bookshelf
    - service: light.turn_on
      data: 
        entity_id: light.book_shelf_color_two
        rgb_color: [255,191,88]
        brightness: 60
        transition: 10
#Left power
    - service: light.turn_on
      data: 
        entity_id: light.onoff_plug_3


- alias: 'xmas_off'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.twinkly
    to: 'off'
  condition:
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  action:
    - service: light.turn_on
      data: 
        entity_id: light.bookshelf_color
        rgb_color: [255,189,84]
        brightness: 137
        transition: 10
    - service: light.turn_on
      data: 
        entity_id: light.book_shelf_color_two
        rgb_color: [255,189,84]
        brightness: 137
        transition: 10
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1_2
        rgb_color: [255,189,84]
        brightness: 10
        transition: 10
    - service: light.turn_off
      data: 
        entity_id: light.onoff_plug_3
    - service: light.turn_on
      data: 
        entity_id: light.hue_go_1
        rgb_color: [255,189,84]
        brightness: 10
        transition: 10

#- alias: Update notifications
#  initial_state: 'on'
#  trigger:
#    - platform: state
#      entity_id: updater.updater
#  action:
#    service: notify.push
#    data_template: 
#      title: 'New Home Assistant Release'
#      message: "Home Assistant  {{ states.updater.updater.state }}  is now available."

- alias: 'Hass Started'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    # Event can also be 'shutdown'
    event: start
  action:
    - service: notify.push
      data:
        title: 'Home Assistant'
        message: 'Online'

- alias: 'Hass Stopped'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    # Event can also be 'shutdown'
    event: shutdown
  action:
    - service: notify.push
      data:
        title: 'Home Assistant'
        message: 'Offline'
 
- alias: 'Hass New Device Tracked'
  trigger:
    platform: event
    event_type: device_tracker_new_device
  action:
    - service: notify.push
      data:
        title: 'New device tracked'
        message: 'Look it up!'
 
- alias: 'Hass Updater'
  trigger:
    - platform: state
      entity_id: updater.updater
  action:
    - service: notify.push
      data: 
        title: 'New Home Assistant Release Available'
        message: 'Home Assistant  is now available.'

- alias: 'Low Battery Sensor hallway'
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.hallway_battery
      below: 10
  action:
    - service: notify.push
      data: 
        title: 'Battery low'
        message: 'Change battery in hallway motion sensor.'
- alias: 'Low Battery Sensor guest room'
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.guest_room_battery
      below: 10
  action:
    - service: notify.push
      data: 
        title: 'Battery low'
        message: 'Change battery in guest room motion sensor.'
- alias: 'Low Battery Sensor kitchen'
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.kitchen_battery
      below: 10
  action:
    - service: notify.push
      data: 
        title: 'Battery low'
        message: 'Change battery in kitchen motion sensor.'
- alias: 'Hass Startup'
  initial_state: 'on'
  trigger:
    - platform: homeassistant
      event: start
  action:
  - service: python_script.count_down_anniversary
  - service: python_script.count_down_engagement
#  - service: python_script.twinkly
#  - service: python_script.dark_sky_friendly_names.py

- alias: 'important'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    # Event can also be 'shutdown'
    event: start
  action:
    - delay:
        seconds: 25
    - service: python_script.count_down_anniversary
    - service: python_script.count_down_engagement
#    - service: python_script.twinkly
#    - service: python_script.dark_sky_friendly_names.py
- alias: 'important2'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    # Event can also be 'shutdown'
    event: start
  action:
    - service: python_script.count_down_anniversary
    - service: python_script.count_down_engagement

- alias: 'update sensors'
  initial_state: 'on'
  trigger:
  - platform: time
    at: '00:10:00'
  action:
  - service: homeassistant.update_entity
    entity_id: 
        - sensor.dates
        - sensor.weekofyear
#######################################
#                                     #
#       Pollen                        #
#                                     #
#######################################
#polleninfo
- alias: 'Polleninfo'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.polleninfo
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.morning
- alias: 'Polleninfo tyst'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.tyst_polleninfo
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.morning_tyst
#pollenalert
- alias: 'Pollen alert'
  initial_state: 'on'
  trigger:
  - platform: template
    value_template: "{{ states.sensor.pollen_gras.state in ['M-H','H', 'H+'] or states.sensor.pollen_bjork.state in ['M-H','H', 'H+'] }}"
  action:
  - service: notify.push
    data_template:
      title: Pollen Alert
      message: 'Höga halter av pollen'




#######################################
#                                     #
#       Skymning                      #
#                                     #
#######################################
- alias: Turn on lights upon Arrival after sunset
  trigger:
  - platform: state
    entity_id: input_select.house_mode
    from: 'Away'
  - platform: state
    entity_id: input_select.house_mode
    from: 'Extended Away'
  condition:
  - condition: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: 4.0  
  action:
  - service: automation.turn_on
    entity_id: automation.window_lightning

- alias: 'window lightning'
  initial_state: true
  trigger:
#  - platform: numeric_state
#    entity_id: sun.sun
#    value_template: '{{ state.attributes.elevation }}'
#    below: 2.5
  - platform: sun
    event: sunset
    offset: "-0:20:00"
  condition:
#  - condition: state
#    entity_id: group.all_devices
#    state: home
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'
  action:
  - service: script.turn_on
    entity_id: 
      - script.skymning
#skymning
- alias: 'Window winter'
  initial_state: 'on'
  trigger:
  - platform: sun
    event: sunset
    offset: "-0:20:00"
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Winter'
    - condition: state
      entity_id: input_select.status_hemma
      state: 'Home'
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
  action:
    - service: script.turn_on
      entity_id: 
        - script.skymning
- alias: 'Window Autumn'
  initial_state: 'on'
  trigger:
  - platform: sun
    event: sunset
    offset: "-0:20:00"
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Autumn'
    - condition: state
      entity_id: input_select.status_hemma
      state: 'Home'
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
  action:
    - service: script.turn_on
      entity_id: 
        - script.skymning

- alias: 'Window Spring'
  initial_state: 'on'
  trigger:
  - platform: sun
    event: sunset
    offset: "+0:20:00"
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Spring'
    - condition: state
      entity_id: input_select.status_hemma
      state: 'Home'
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
  action:
    - service: script.turn_on
      entity_id: 
        - script.skymning

- alias: 'Window Summer'
  initial_state: 'on'
  trigger:
  - platform: sun
    event: sunset
    offset: "+0:40:00"
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Summer'
    - condition: state
      entity_id: input_select.status_hemma
      state: 'Home'
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
  action:
    - service: script.turn_on
      entity_id: 
        - script.skymning

#######################################
#                                     #
#       Belysning                     #
#                                     #
#######################################

- alias: 'Reset after power failure'
  initial_state: 'on'
  trigger:
  - platform: numeric_state
    entity_id: light.hue_color_candle_1
    value_template: '{{ state.attributes.brightness }}'
    above: 253
  condition:
      - condition: template
        value_template: "{{ states.sensor.period_of_day.state != 'night' }}"
  action:
    - service: light.turn_on
      data: 
        entity_id: light.bedroom_light, light.bedroom_window_light, light.book_shelf_color_two, light.bookshelf_color, light.guest_room_1, light.guest_room_2, light.guest_room_3, light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger, light.kitchen_fan, light.kitchen_fan_2, light.kitchen_sink, light.kitchen_sink_two, light.hue_color_candle_1, light.living_room_right_sofa, light.living_room_window_light
        color_temp: 454
        brightness: 135
    - delay:
        seconds: 1
    - service: light.turn_off
      entity_id: light.bedroom_light, light.bedroom_window_light, light.book_shelf_color_two, light.bookshelf_color, light.guest_room_1, light.guest_room_2, light.guest_room_3, light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger, light.kitchen_fan, light.kitchen_fan_2, light.kitchen_sink, light.kitchen_sink_two, light.hue_color_candle_1, light.living_room_right_sofa, light.living_room_window_light, light.onoff_plug_1
    - service: notify.push
      data_template:
        title: Power failure
        message: 'Strömavbrott'


- alias: 'Reset after power failure two'
  initial_state: 'on'
  trigger:
  - platform: numeric_state
    entity_id: light.hue_color_candle_1
    value_template: '{{ state.attributes.brightness }}'
    above: 253
  condition:
      - condition: template
        value_template: "{{ states.sensor.period_of_day.state != 'dawn' }}"
  action:
    - service: light.turn_on
      data: 
        entity_id: light.book_shelf_color_two, light.bookshelf_color, light.living_room_right_sofa, light.living_room_window_light
        rgb_color: [255,189,84]
        brightness: 150
    - service: light.turn_on
      data: 
        entity_id: light.bedroom_window_light, light.guest_room_1, light.guest_room_2, light.guest_room_3, light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger, light.kitchen_fan, light.kitchen_fan_2, light.kitchen_sink, light.kitchen_sink_two, light.hue_color_candle_1
    - delay:
        seconds: 1
    - service: light.turn_off
      entity_id: light.bedroom_light, light.bedroom_window_light, light.guest_room_1, light.guest_room_2, light.guest_room_3, light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger, light.kitchen_fan, light.kitchen_fan_2, light.kitchen_sink, light.kitchen_sink_two, light.onoff_plug_1
    - service: notify.push
      data_template:
        title: Power failure
        message: 'Strömavbrott'

- alias: 'Reset after power failure three'
  initial_state: 'on'
  trigger:
  - platform: numeric_state
    entity_id: light.hue_color_candle_1
    value_template: '{{ state.attributes.brightness }}'
    above: 253
  condition:
      - condition: template
        value_template: "{{ states.sensor.period_of_day.state != 'day' }}"
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
  action:
    - service: light.turn_on
      data: 
        entity_id: light.bedroom_light, light.bedroom_window_light, light.book_shelf_color_two, light.bookshelf_color, light.guest_room_1, light.guest_room_2, light.guest_room_3, light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger, light.kitchen_fan, light.kitchen_fan_2, light.kitchen_sink, light.kitchen_sink_two, light.hue_color_candle_1, light.living_room_right_sofa, light.living_room_window_light
        color_temp: 454
        brightness: 135
    - delay:
        seconds: 1
    - service: light.turn_off
      entity_id: light.bedroom_light, light.bedroom_window_light, light.book_shelf_color_two, light.bookshelf_color, light.guest_room_1, light.guest_room_2, light.guest_room_3, light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger, light.kitchen_fan, light.kitchen_fan_2, light.kitchen_sink, light.kitchen_sink_two, light.hue_color_candle_1, light.living_room_right_sofa, light.living_room_window_light, light.onoff_plug_1
    - service: notify.push
      data_template:
        title: Power failure
        message: 'Strömavbrott'
#######################################
#                                     #
#      Fönster                        #
#                                     #
#######################################
- alias: 'Fönster'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.window
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light, light.hue_color_candle_1
      brightness: '{{ states.input_number.window.state | int * 2.55 | round(0) }}'
      transition: 10
#######################################
#                                     #
#       Släck när vi inte är hemma    #
#                                     #
#######################################

#allt av
#- alias: "Allt av"
#  trigger:
#  - platform: time
#    at: '22:10:00'
#  action:
#  - service: scene.turn_on
#    data:
#     entity_id: scene.all_off
#######
#sovrummet fönster
#######
- alias: 'bw_lamp_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bw_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1_4
      brightness: '{{ states.input_number.bw_lamp_bright.state | int }}'
- alias: 'bw_lamp_temp'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bw_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1_4
      color_temp: '{{ states.input_number.bw_lamp_temp.state | int }}'
- alias: 'bw_lamp_white'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bw_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1_4
      white_value: '{{ states.input_number.bw_lamp_white.state | int }}'
#######
#sovrummet
#######
- alias: 'bedroom_lamp_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bedroom_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1_4, light.bedroom_light
      brightness: '{{ states.input_number.bedroom_lamp_bright.state | int }}'

- alias: 'bedroom_lamp_temp'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bedroom_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1_4, light.bedroom_light
      color_temp: '{{ states.input_number.bedroom_lamp_temp.state | int }}'

- alias: 'bedroom_lamp_white'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bedroom_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1_4, light.bedroom_light
      white_value: '{{ states.input_number.bedroom_lamp_white.state | int }}'
#######
#sovrummet vägg
#######

- alias: 'bwall_lamp_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bwall_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_light
      brightness: '{{ states.input_number.bwall_lamp_bright.state | int }}'

- alias: 'bwall_lamp_temp'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bwall_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_light
      color_temp: '{{ states.input_number.bwall_lamp_temp.state | int }}'

- alias: 'bwall_lamp_white'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bwall_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bedroom_light
      white_value: '{{ states.input_number.bwall_lamp_white.state | int }}'

- alias: 'Fönster sovrum dim'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.s_rum_vindow
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1_4
      brightness: '{{ states.input_number.s_rum_vindow.state | int * 2.55 | round(0) }}'
#######
#hallen
#######
- alias: 'hall_lamp_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.hall_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger
      brightness: '{{ states.input_number.hall_lamp_bright.state | int }}'
- alias: 'hall_lamp_temp'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.hall_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger
      color_temp: '{{ states.input_number.hall_lamp_temp.state | int }}'
- alias: 'hall_lamp_white'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.hall_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger
      white_value: '{{ states.input_number.hall_lamp_white.state | int }}'
#######
#köket
#######
- alias: 'kitchen_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.kitchen_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1, light.kitchen_sink, light.kitchen_sink_two, light.kitchen_fan
      brightness: '{{ states.input_number.kitchen_bright.state | int }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.k_w_lamp_bright, input_number.sink_lamp_bright
      value: "{{states.input_number.kitchen_bright.state}}"
      
- alias: 'k_w_lamp_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.k_w_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1
      brightness: '{{ states.input_number.k_w_lamp_bright.state | int }}'
- alias: 'k_w_lamp_temp'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.k_w_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1
      color_temp: '{{ states.input_number.k_w_lamp_temp.state | int }}'
- alias: 'k_w_lamp_white'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.k_w_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1
      white_value: '{{ states.input_number.k_w_lamp_white.state | int }}'
# window
- alias: 'Fönster köket dim'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.hue_color_candle_1
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.hue_color_candle_1
      brightness: '{{ states.input_number.kitchen_vindow.state | int * 2.55 | round(0) }}'

- alias: 'sink_lamp_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.sink_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.kitchen_fan, light.kitchen_sink, light.kitchen_sink_two
      brightness: '{{ states.input_number.sink_lamp_bright.state | int }}'

#######
#vardagsrummet
#######
- alias: 'Set livingroom color'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_select.livingroom
  condition:
    condition: template
    value_template: "{{ states('input_select.livingroom') != 'normal' }}"
  action:
    service: light.turn_on
    data_template:
      entity_id: light.bookshelf_color, light.book_shelf_color_two, light.living_room_window_light,hue_color_candle_1_2
      color_name: "{{ states.input_select.livingroom.state }}"
#######
#vardagsrum fönster
#######
- alias: 'lr_w_lamp_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.lr_w_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light
      brightness: '{{ states.input_number.lr_w_lamp_bright.state | int }}'

- alias: 'lr_w_lamp_temp'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.lr_w_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light
      color_temp: '{{ states.input_number.lr_w_lamp_temp.state | int }}'

- alias: 'lr_w_lamp_white'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.lr_w_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light
      white_value: '{{ states.input_number.lr_w_lamp_white.state | int }}'
#######
#vardagsrummet
#######
- alias: 'livingroom_lamp_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.livingroom_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light, light.bookshelf_color, light.book_shelf_color_two
      brightness: '{{ states.input_number.livingroom_lamp_bright.state | int }}'

- alias: 'livingroom_lamp_temp'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.livingroom_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light, light.bookshelf_color, light.book_shelf_color_two
      color_temp: '{{ states.input_number.livingroom_lamp_temp.state | int }}'

- alias: 'livingroom_lamp_white'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.livingroom_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light, light.bookshelf_color, light.book_shelf_color_two
      white_value: '{{ states.input_number.livingroom_lamp_white.state | int }}'
#######
#vardagsrum bokhylla
#######
- alias: 'bookshelf_lamp_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bookshelf_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bookshelf_color, light.book_shelf_color_two
      brightness: '{{ states.input_number.bookshelf_lamp_bright.state | int }}'
- alias: 'bookshelf_lamp_temp'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bookshelf_lamp_temp
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bookshelf_color, light.book_shelf_color_two
      color_temp: '{{ states.input_number.bookshelf_lamp_temp.state | int }}'
- alias: 'bookshelf_lamp_white'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.bookshelf_lamp_white
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.bookshelf_color, light.book_shelf_color_two
      white_value: '{{ states.input_number.bookshelf_lamp_white.state | int }}'

- alias: 'Fönster soffbord höger dim'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.v_rum_sofa_r
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_right_sofa
      brightness: '{{ states.input_number.v_rum_sofa_r.state | int * 2.55 | round(0) }}'
- alias: 'Fönster soffbord vänster dim'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.v_rum_sofa_l
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.vanster_soffbord
      brightness: '{{ states.input_number.v_rum_sofa_l.state | int * 2.55 | round(0) }}'
- alias: 'Vardagsrum dim'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.v_rum
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light, light.bookshelf_color, light.book_shelf_color_two, light.living_room_right_sofa
      brightness: '{{ states.input_number.v_rum.state | int * 2.55 | round(0) }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.v_rum_sofa_l, input_number.v_rum_sofa_r, input_number.v_rum_vindow
      value: "{{states.input_number.v_rum.state}}"
      
- alias: 'Fönster vardagsrum dim'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.v_rum_vindow
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.living_room_window_light
      brightness: '{{ states.input_number.v_rum_vindow.state | int * 2.55 | round(0) }}'
#######
#guest room
#######
- alias: 'guest_lamp_bright'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_number.guest_lamp_bright
  action:
  - service: light.turn_on
    data_template:
      entity_id: light.guest_room_1, light.guest_room_2, light.guest_room_3
      brightness: '{{ states.input_number.guest_lamp_bright.state | int }}'

#######################################
#                                     #
#       Godnatt & Godmorgon           #
#                                     #
#######################################
#läggdagslidija vardagar
- alias: 'Bedtime Lidija'
  initial_state: 'on'
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.fading_time.state }}'
  condition:
  - condition: state
    entity_id: input_boolean.fadelight
    state: 'on'
  - condition: state
    entity_id: input_boolean.alarmweekday_lidija
    state: 'on'
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  action:
  - service: script.turn_on
    entity_id: script.sleep

#######################################
#                                     #
#       Temperatur                    #
#                                     #
#######################################
- alias: 'Kallt i lägenheten'
  initial_state: 'on'
  trigger:
    platform: numeric_state
    entity_id: sensor.medel_temperatur
    below: 16
  condition:
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  action:
    service: notify.push
    data_template:
      title: Kallt i lägenheten
      message: Nu är det kallt

#######################################
#                                     #
#       Motion                        #
#                                     #
#######################################
- alias: 'Friday 13'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  condition:
  - condition: time
    weekday:
    - fri
  - condition: template
    value_template: '{{ now().weekday() == 4 and now().day == 13 }}'
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id:  media_player.bedroom
    state: 'off'
  - condition: state
    entity_id: media_player.chromecast_audio
    state: 'off'
  - condition: state
    entity_id: media_player.hallway
    state: 'off'
  - condition: state
    entity_id: media_player.kitchen
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_left
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_display
    state: 'off'
  - condition: state
    entity_id:  media_player.living_room_speaker
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_right
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: script.friday13
- alias: 'Alarm när vi inte är hemma'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.ha_alarm
    state: armed_away
  - condition: state
    entity_id: input_select.house_mode
    state: 'Away'
  action:
  - service: notify.push
    data_template:
      title: 'Alert'
      message:  'Larmet går! Tjuvar i lägenheten'
      
- alias: 'Welcome hallway'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - sat
    - sun
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id:  media_player.bedroom
    state: 'off'
  - condition: state
    entity_id: media_player.chromecast_audio
    state: 'off'
  - condition: state
    entity_id: media_player.hallway
    state: 'off'
  - condition: state
    entity_id: media_player.kitchen
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_left
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_display
    state: 'off'
  - condition: state
    entity_id:  media_player.living_room_speaker
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_right
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: 
      - script.hallway
- alias: 'Welcome hallway 2'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  condition:
  - condition: time
    weekday:
    - fri
  - condition: template
    value_template: '{{ now().weekday() == 4 and now().day != 13 }}'
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id:  media_player.bedroom
    state: 'off'
  - condition: state
    entity_id: media_player.chromecast_audio
    state: 'off'
  - condition: state
    entity_id: media_player.hallway
    state: 'off'
  - condition: state
    entity_id: media_player.kitchen
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_left
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_display
    state: 'off'
  - condition: state
    entity_id:  media_player.living_room_speaker
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_right
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: 
      - script.hallway

- alias: 'welcome guest'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.guest_room_motion_sensor
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id:  media_player.bedroom
    state: 'off'
  - condition: state
    entity_id: media_player.chromecast_audio
    state: 'off'
  - condition: state
    entity_id: media_player.hallway
    state: 'off'
  - condition: state
    entity_id: media_player.kitchen
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_left
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_display
    state: 'off'
  - condition: state
    entity_id:  media_player.living_room_speaker
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_right
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'    
  action:
  - service: script.turn_on
    entity_id: 
      - script.guest_room

- alias: 'Welcome kitchen'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.kitchen_motion_motion_sensor
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id:  media_player.bedroom
    state: 'off'
  - condition: state
    entity_id: media_player.chromecast_audio
    state: 'off'
  - condition: state
    entity_id: media_player.hallway
    state: 'off'
  - condition: state
    entity_id: media_player.kitchen
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_left
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_display
    state: 'off'
  - condition: state
    entity_id:  media_player.living_room_speaker
    state: 'off'
  - condition: state
    entity_id: media_player.living_room_right
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: 
      - script.kitchen

- alias: 'Enable speak in kitchen'
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_kitchen_tts
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.kitchen_tts

- alias: 'Enable speak in guest room'
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_guest_tts
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.guest_tts

- alias: 'Enable speak in hallway'
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_hallway_tts
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.hallway_tts
#- alias: 'turn on light in entry hall when motion'
#  trigger:
#  - platform: state
#    entity_id: sensor.hallway_motion_sensor
#    to: 'on'
#  condition:
#      - condition: template
#        value_template: "{{ states.sensor.period_of_day.state != 'night' }}"
#  action:
#  - service: light.turn_on
#    entity_id: light.onoff_plug_1
#
#- alias: 'turn off light in entry hall when no motion'
#  initial_state: 'on'
#  trigger:
#    platform: state
#    entity_id: sensor.hallway_motion_sensor
#    to: 'off'
#    for:
#      minutes: 5
#  action:
#    service: light.turn_off
#    entity_id: light.onoff_plug_1
#######################################
#                                     #
#       Media                         #
#                                     #
#######################################
# - alias: 'something playing'
#   initial_state: 'on'
#   trigger:
#   - platform: state
#     entity:
#          data_template:
#            entity_id: >
#             {% if is_state("media_player.bedroom", "on") %} 
#             input_boolean.audio_off: 'on'
#             {% elif is_state("media_player.chromecast_audio", "on") %} 
#             input_boolean.audio_off: 'on'
#             {% elif is_state("media_player.hallway", "on") %} 
#             input_boolean.audio_off: 'on'
#             {% elif is_state("media_player.kitchen", "on") %} 
#             input_boolean.audio_off: 'on'
#             {% elif is_state("media_player.living_room_left", "on") %} 
#             input_boolean.audio_off: 'on'
#             {% elif is_state("media_player.living_room_display", "on") %} 
#             input_boolean.audio_off: 'on'
#             {% elif is_state("media_player.living_room_speaker", "on") %} 
#             input_boolean.audio_off: 'on'
#             {% elif is_state("media_player.living_room_right", "on") %} 
#             input_boolean.audio_off: 'on'
#             {% else %} 
#             input_boolean.audio_off: 'off'
#             {% endif %}
#casting
- alias: 'casting'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: media_player.chromecastultra6229
    to: 'playing'
  action:
  - service: script.turn_on
    entity_id: script.tv_hdmi2
  - delay: '00:00:01'
  - service: script.turn_on
    entity_id: script.denon_tv

- alias: 'Play Spotify'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.play_spotify
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.play_spotify
#tv/stereo
      
- alias: 'Volume kitchen'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_kitchen2
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.kitchen
      volume_level: '{{  states.input_number.spotify_volume_kitchen.state }}'
- alias: 'Volume Living room left'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_lr_l
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_left
      volume_level: '{{  states.input_number.spotify_volume_lr_l.state }}'
- alias: 'Volume Living room right'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_lr_r
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_right
      volume_level: '{{  states.input_number.spotify_volume_lr_r.state }}'
- alias: 'Volume Living room speaker'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_lr
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_speaker
      volume_level: '{{  states.input_number.spotify_volume_lr.state }}'
- alias: 'Volume Hallway'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_hallway
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.hallway
      volume_level: '{{  states.input_number.spotify_volume_hallway.state }}'
- alias: 'Volume Bedroom'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_bedroom
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.bedroom
      volume_level: '{{  states.input_number.spotify_volume_bedroom.state }}'   
- alias: 'Volume cca'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_cca
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.chromecast_audio
      volume_level: '{{  states.input_number.spotify_volume_cca.state }}'

- alias: 'Volume hub'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: media_player.living_room_display
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_display
      volume_level: '{{  states.input_number.spotify_volume_hub.state }}'
      
- alias: 'Volume All'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_all
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.kitchen, media_player.living_room_left, media_player.living_room_right, media_player.living_room_speaker, media_player.hallway, media_player.chromecast_audio, media_player.bedroom, media_player.living_room_display
      volume_level: '{{  states.input_number.spotify_volume_all.state }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.spotify_volume_kitchen, input_number.spotify_volume_hallway, input_number.spotify_volume_lr, input_number.spotify_volume_lr_r, input_number.spotify_volume_lr_l, input_number.spotify_volume_living_room, input_number.spotify_volume_music, input_number.spotify_volume_cca, input_number.spotify_volume_bedroom, input_number.spotify_volume_hub
      value: "{{ states.input_number.spotify_volume_all.state }}"
- alias: 'Volume Music'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_music
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.kitchen, media_player.living_room_left, media_player.living_room_right, media_player.living_room_speaker
      volume_level: '{{  states.input_number.spotify_volume_music.state }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.spotify_volume_kitchen, input_number.spotify_volume_hallway, input_number.spotify_volume_lr, input_number.spotify_volume_lr_r, input_number.spotify_volume_lr_l, input_number.spotify_volume_living_room
      value: "{{ states.input_number.spotify_volume_music.state }}"
- alias: 'Volume Livingroom'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_living_room
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_left, media_player.living_room_right, media_player.living_room_speaker
      volume_level: '{{  states.input_number.spotify_volume_living_room.state }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.spotify_volume_lr, input_number.spotify_volume_lr_r, input_number.spotify_volume_lr_l
      value: "{{ states.input_number.spotify_volume_living_room.state }}"
#######################################
#                                     #
#       Kaffe                         # 
#                                     #
#######################################
- alias: 'kitchen plug'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: light.kaffe
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.coffee_on
#kaffetimer
- alias: 'Kaffe'
  initial_state: 'on'
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.coffeetime.state }}'
  condition:
  - condition: state
    entity_id: input_boolean.coffeornot
    state: 'on'
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  action:
  - service: script.turn_on
    entity_id: script.coffee_on
#kaffe off automatic
- alias: Turn off perkulator at end of timer
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_perka
  action:
  - service: script.turn_on
    entity_id: script.coffee_off
  - delay:
      seconds: 2
  - service: script.turn_on
    entity_id: script.coffeedone
#vattenkokare on
- alias: 'Vattenkokare on'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.vattenkokare
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.vattenkokare_on
#vattenkokare on
- alias: 'Vattenkokare on'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.perka
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.coffee_on
#vattenkokare off automatic
- alias: Turn off vattenkokare at end of timer
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_vattenkokare
  action:
  - service: script.turn_on
    entity_id: script.coffee_off
