- alias: 'Automatic Goodnight'
  initial_state: 'on'
  trigger:
    - platform: time
      at: '22:00:00'
  condition:
  - condition: state
    entity_id: input_select.house_mode
    state: 'Away'
  action:
    - service: script.turn_on
      data: 
        entity_id: script.goodbye3
    - delay:
        seconds: 600
    - service: light.turn_off
      data: 
        entity_id: group.all_actual_lights



#######################################
#                                     #
#       Mode                          #
#                                     #
#######################################
- alias: 'Winter'
  initial_state: 'on'
  trigger:
  - platform: time
    at: '00:10:00'
  - platform: homeassistant
    event: start
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Winter'
  action:
  - service: input_select.select_option
    entity_id: input_select.status_season
    data:
      option: 'Winter'

- alias: 'Spring'
  initial_state: 'on'
  trigger:
  - platform: time
    at: '00:10:00'
  - platform: homeassistant
    event: start
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Spring'
  action:
  - service: input_select.select_option
    entity_id: input_select.status_season
    data:
      option: 'Spring'
- alias: 'Summer'
  initial_state: 'on'
  trigger:
  - platform: time
    at: '00:10:00'
  - platform: homeassistant
    event: start
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Summer'
  action:
  - service: input_select.select_option
    entity_id: input_select.status_season
    data:
      option: 'Summer'
- alias: 'Autumn'
  initial_state: 'on'
  trigger:
  - platform: time
    at: '00:10:00'
  - platform: homeassistant
    event: start
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Autumn'
  action:
  - service: input_select.select_option
    entity_id: input_select.status_season
    data:
      option: 'Autumn'

#  - service: scene.turn_on
#    data:
#     entity_id: scene.all_off

- alias: 'xmas to on'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.xmas
    to: 'on'
  action:
  - service: switch.turn_on
    data: 
      entity_id: switch.xmas

- alias: 'xmas to off'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.xmas
    to: 'off'
  action:
  - service: switch.turn_off
    data: 
      entity_id: switch.xmas

- alias: 'new year to on'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.new_year
    to: 'on'
  action:
  - service: switch.turn_on
    data: 
      entity_id: switch.new_year

- alias: 'new year to off'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.new_year
    to: 'off'
  action:
  - service: switch.turn_off
    data: 
      entity_id: switch.new_year

- alias: 'halloween to on'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.halloween
    to: 'on'
  action:
  - service: switch.turn_on
    data: 
      entity_id: switch.halloween

- alias: 'halloween to off'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.halloween
    to: 'off'
  action:
  - service: switch.turn_off
    data: 
      entity_id: switch.halloween

- alias: 'party to on'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.party
    to: 'on'
  action:
  - service: switch.turn_on
    data: 
      entity_id: switch.party
  - service: scene.turn_on
    data:
     entity_id: scene.party
     
- alias: 'party to on2'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.party
    to: 'on'
  action:
  - service: input_boolean.turn_on
    data: 
      entity_id: input_boolean.party
  - service: scene.turn_on
    data:
     entity_id: scene.party

- alias: 'party to off'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.party
    to: 'off'
  action:
  - service: switch.turn_off
    data: 
      entity_id: switch.party

- alias: 'party to off2'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.party
    to: 'off'
  action:
  - service: input_boolean.turn_off
    data: 
      entity_id: input_boolean.party

#######################################
#                                     #
#       System                        #
#                                     #
#######################################

- alias: 'Low Battery CG Phone'
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.phone_battery
      below: 25
  condition:
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
    - condition: time
      after: '07:00'
      before: '22:00'
    - condition: state
      entity_id: sensor.phone_battery9
      state: 'false'
  action:
  - service: script.turn_on
    entity_id: script.cg_phone

- alias: 'Low Battery LT Phone'
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.phone_battery2
      below: 25
  condition:
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
    - condition: time
      after: '07:00'
      before: '22:00'
    - condition: state
      entity_id: sensor.phone_battery3
      state: 'false'
  action:
  - service: script.turn_on
    entity_id: script.lt_phone

#- alias: Update notifications
#  initial_state: 'on'
#  trigger:
#    - platform: state
#      entity_id: updater.updater
#  action:
#    service: notify.push
#    data_template: 
#      title: 'New Home Assistant Release'
#      message: "Home Assistant  {{ states.updater.updater.state }}  is now available."

- alias: 'Halloween boolean on'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.halloween
    to: 'on'
  action:
  - service: switch.turn_on
    data: 
      entity_id: switch.halloween

- alias: 'Halloween boolean off'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.halloween
    to: 'off'
  action:
  - service: switch.turn_off
    data: 
      entity_id: switch.halloween

- alias: 'Halloween switch on'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.halloween
    to: 'on'
  action:
  - service: input_boolean.turn_on
    data: 
      entity_id: input_boolean.halloween

- alias: 'Halloween switch off'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.halloween
    to: 'off'
  action:
  - service: input_boolean.turn_off
    data: 
      entity_id: input_boolean.halloween

- alias: 'Hass Started'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    # Event can also be 'shutdown'
    event: start
  action:
    - service: notify.push
      data:
        title: 'Home Assistant'
        message: 'Online'

- alias: 'Hass Stopped'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    # Event can also be 'shutdown'
    event: shutdown
  condition:
    - condition: state
      entity_id: input_select.house_mode
      state: 'Away'
  action:
    - service: notify.push
      data:
        title: 'Home Assistant'
        message: 'Offline'
 
- alias: 'Hass New Device Tracked'
  initial_state: 'on'
  trigger:
    platform: event
    event_type: device_tracker_new_device
  action:
    - service: notify.push
      data:
        title: 'New device tracked'
        message: 'Look it up!'
 
- alias: 'Hass Updater'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: updater.updater
  action:
    - service: notify.push
      data: 
        title: 'New Home Assistant Release Available'
        message: 'Home Assistant  is now available.'

- alias: 'Low Battery Sensor hallway'
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.hallway_battery
      below: 10
  action:
    - service: notify.push
      data: 
        title: 'Battery low'
        message: 'Change battery in hallway motion sensor.'
- alias: 'Low Battery Sensor guest room'
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.guest_room_battery
      below: 10
  action:
    - service: notify.push
      data: 
        title: 'Battery low'
        message: 'Change battery in guest room motion sensor.'
- alias: 'Low Battery Sensor kitchen'
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.kitchen_battery
      below: 10
  action:
    - service: notify.push
      data: 
        title: 'Battery low'
        message: 'Change battery in kitchen motion sensor.'
- alias: 'Hass Startup'
  initial_state: 'on'
  trigger:
    - platform: homeassistant
      event: start
  action:
  - service: python_script.count_down_anniversary
  - service: python_script.count_down_engagement
#  - service: python_script.twinkly
#  - service: python_script.dark_sky_friendly_names.py

- alias: 'important'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    # Event can also be 'shutdown'
    event: start
  action:
    - delay:
        seconds: 25
    - service: python_script.count_down_anniversary
    - service: python_script.count_down_engagement
#    - service: python_script.twinkly
#    - service: python_script.dark_sky_friendly_names.py
- alias: 'important2'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    # Event can also be 'shutdown'
    event: start
  action:
    - service: python_script.count_down_anniversary
    - service: python_script.count_down_engagement

- alias: 'update sensors'
  initial_state: 'on'
  trigger:
  - platform: time
    at: '00:10:00'
  action:
  - service: homeassistant.update_entity
    entity_id: 
        - sensor.dates
        - sensor.weekofyear
#######################################
#                                     #
#       Pollen                        #
#                                     #
#######################################
#polleninfo
- alias: 'Polleninfo'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.polleninfo
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.morning
- alias: 'Polleninfo tyst'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.tyst_polleninfo
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.morning_tyst
#pollenalert
- alias: 'Pollen alert'
  initial_state: 'on'
  trigger:
  - platform: template
    value_template: "{{ states.sensor.pollen_gras.state in ['M-H','H', 'H+'] or states.sensor.pollen_bjork.state in ['M-H','H', 'H+'] }}"
  action:
  - service: notify.push
    data_template:
      title: Pollen Alert
      message: 'Höga halter av pollen'

#######################################
#                                     #
#       Morning                       #
#                                     #
#######################################

- alias: morning
  initial_state: 'on'
  trigger:
    - platform: time
      at: '07:00:00'
  condition:
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
  action:
  - service: script.turn_on
    entity_id: 
      - script.morning_routine

- alias: morning
  initial_state: 'on'
  trigger:
    - platform: time
      at: '08:30:00'
  condition:
    - condition: state
      entity_id: input_select.house_mode
      state: 'Away'
  action:
  - service: scene.turn_on
    entity_id: 
      - scene.morning_twillight_off
#######################################
#                                     #
#       Skymning                      #
#                                     #
#######################################
- alias: Turn on lights upon Arrival after sunset
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_select.house_mode
    from: 'Away'
  - platform: state
    entity_id: input_select.house_mode
    from: 'Extended Away'
  condition:
  - condition: numeric_state
    entity_id: sun.sun
    value_template: '{{ states.attributes.elevation }}'
    below: 4.0  
  - condition: numeric_state
    entity_id: 'sensor.kitchen_lux'
    below: 5.0
  - condition: time
    after: '14:00'
    before: '21:45'
  - condition: state
    entity_id: light.living_room_window_light
    state: 'off'
  - condition: state
    entity_id: switch.party
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: 
      - script.dusk_window

- alias: Living Room Lamp - Sunset
  trigger:
    - platform: sun
      event: sunset
      offset: "+0:55:00"
    - platform: state
      entity_id: input_select.house_mode
      to: 'Home'
  condition:
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
    - condition: sun 
      after: sunset 
      after_offset: "+0:55:00"
    - condition: state
      entity_id: switch.party
      state: 'off'
    - condition: numeric_state
      entity_id: 'sensor.kitchen_lux'
      below: 5.0
    - condition: time
      after: '14:00'
      before: '21:45'
    - condition: state
      entity_id: light.living_room_window_light
      state: 'off'
  action:
  - service: script.turn_on
    entity_id: 
      - script.dusk_inside

- alias: 'window lightning'
  initial_state: true
  trigger:
#  - platform: numeric_state
#    entity_id: sun.sun
#    value_template: '{{ states.attributes.elevation }}'
#    below: 2.5
  - platform: sun
    event: sunset
    offset: "-0:20:00"
  condition:
#  - condition: state
#    entity_id: group.all_devices
#    state: home
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'
  - condition: state
    entity_id: switch.party
    state: 'off'
  - condition: numeric_state
    entity_id: 'sensor.kitchen_lux'
    below: 5.0
  - condition: time
    after: '14:00'
    before: '21:45'
  - condition: state
    entity_id: light.living_room_window_light
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: 
      - script.dusk_window
#skymning
- alias: 'Window winter'
  initial_state: 'on'
  trigger:
  - platform: sun
    event: sunset
    offset: "-0:20:00"
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Winter'
    - condition: state
      entity_id: input_select.status_hemma
      state: 'Home'
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
    - condition: state
      entity_id: switch.party
      state: 'off'
    - condition: numeric_state
      entity_id: 'sensor.kitchen_lux'
      below: 5.0
    - condition: time
      after: '14:00'
      before: '21:45'
    - condition: state
      entity_id: light.living_room_window_light
      state: 'off'
  action:
    - service: script.turn_on
      entity_id: 
        - script.dusk_window
- alias: 'Window Autumn'
  initial_state: 'on'
  trigger:
  - platform: sun
    event: sunset
    offset: "-0:20:00"
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Autumn'
    - condition: state
      entity_id: input_select.status_hemma
      state: 'Home'
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
    - condition: state
      entity_id: switch.party
      state: 'off'
    - condition: numeric_state
      entity_id: 'sensor.kitchen_lux'
      below: 5.0
    - condition: time
      after: '14:00'
      before: '21:45'
    - condition: state
      entity_id: light.living_room_window_light
      state: 'off'
  action:
    - service: script.turn_on
      entity_id: 
        - script.dusk_window

- alias: 'Window Spring'
  initial_state: 'on'
  trigger:
  - platform: sun
    event: sunset
    offset: "+0:35:00"
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Spring'
    - condition: state
      entity_id: input_select.status_hemma
      state: 'Home'
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
    - condition: state
      entity_id: switch.party
      state: 'off'
    - condition: numeric_state
      entity_id: 'sensor.kitchen_lux'
      below: 5.0
    - condition: time
      after: '14:00'
      before: '21:45'
    - condition: state
      entity_id: light.living_room_window_light
      state: 'off'
  action:
    - service: script.turn_on
      entity_id: 
        - script.dusk_window

- alias: 'Window Summer'
  initial_state: 'on'
  trigger:
  - platform: sun
    event: sunset
    offset: "+0:55:00"
  condition:
    - condition: state
      entity_id: sensor.seasons
      state: 'Summer'
    - condition: state
      entity_id: input_select.status_hemma
      state: 'Home'
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
    - condition: state
      entity_id: switch.party
      state: 'off'
    - condition: numeric_state
      entity_id: 'sensor.kitchen_lux'
      below: 5.0
    - condition: time
      after: '14:00'
      before: '21:45'
    - condition: state
      entity_id: light.living_room_window_light
      state: 'off'
  action:
    - service: script.turn_on
      entity_id: 
        - script.dusk_window

- alias: 'dusk inside'
  initial_state: 'on'
  trigger:
  - platform: sun
    event: sunset
    offset: "+0:55:00"
  condition:
    - condition: state
      entity_id: input_select.status_hemma
      state: 'Home'
    - condition: state
      entity_id: input_select.house_mode
      state: 'Home'
    - condition: state
      entity_id: switch.party
      state: 'off'
    - condition: numeric_state
      entity_id: 'sensor.kitchen_lux'
      below: 5.0
    - condition: time
      after: '14:00'
      before: '21:45'
  action:
    - service: script.turn_on
      entity_id: 
        - script.dusk_inside
#######################################
#                                     #
#       Belysning                     #
#                                     #
#######################################

- alias: Set Front Lights Color
  trigger:
    platform: state
    entity_id: input_select.livingroom
  condition:
    condition: template
    value_template: "{{ states('input_select.livingroom') != 'Normal' }}"
  action:
    service: light.turn_on
    data_template:
      entity_id: group.livingroom_lights
      color_name: "{{ states.input_select.livingroom.state }}"

- alias: 'Reset after power failure'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: light.hue_color_candle_1
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_select.house_mode
      state: 'Away'
  action:
#    - service: light.turn_on
#      data: 
#        entity_id: light.bedroom_light, light.bedroom_window_light, light.book_shelf_color_two, light.bookshelf_color, light.guest_room_1, light.guest_room_2, light.guest_room_3, light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger, light.kitchen_fan, light.kitchen_fan_2, light.kitchen_sink, light.kitchen_sink_two, light.hue_color_candle_1, light.living_room_right_sofa, light.living_room_window_light
#        color_temp: 454
#        brightness: 135
#    - delay:
#        seconds: 1
#    - service: light.turn_off
#      entity_id: light.bedroom_light, light.bedroom_window_light, light.book_shelf_color_two, light.bookshelf_color, light.guest_room_1, light.guest_room_2, light.guest_room_3, light.hallway_1, light.hallway_2, light.hallway_3, light.hallway_hanger, light.kitchen_fan, light.kitchen_fan_2, light.kitchen_sink, light.kitchen_sink_two, light.hue_color_candle_1, light.living_room_right_sofa, light.living_room_window_light, light.onoff_plug_1, light.onoff_plug_2, light.onoff_plug_3, light.onoff_plug_4
    - service: notify.push
      data_template:
        title: 'Power failure'
        message: 'Strömavbrott'

- alias: 'random color on lights'
  trigger:
  - seconds: /1200
    platform: time
  condition:
  - condition: state
    entity_id: switch.party
    state: 'on'
  action:
    - service: script.toggle
      entity_id: 
        - script.party_random

- alias: "xmas_song"
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: media_player.all,media_player.spa
    to: 'playing'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:4ylXKnf5PQdCcOiXzKGysV" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:3IfnHtJEDnOP7J2qXN9wsi" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:7vQbuQcyTflfCIOu3Uzzya" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:0bYg9bo50gSsH3LtXe2SQn" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:0F2o0i9Qg7lFU9unvIPzvi" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:5a1iz510sv2W9Dt1MvFd5R" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:4ricyQVd20UQde1jpXCSuJ" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:11P4sSu6BH2lAbWk1sL6cK" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "spotify:track:177r7J6bnoMnW4MQx1GQng" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:4ylXKnf5PQdCcOiXzKGysV" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:3IfnHtJEDnOP7J2qXN9wsi" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:7vQbuQcyTflfCIOu3Uzzya" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:0bYg9bo50gSsH3LtXe2SQn" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:0F2o0i9Qg7lFU9unvIPzvi" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:5a1iz510sv2W9Dt1MvFd5R" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:4ricyQVd20UQde1jpXCSuJ" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:11P4sSu6BH2lAbWk1sL6cK" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "spotify:track:177r7J6bnoMnW4MQx1GQng" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "http://christmas.allchristmashitsradio.com:8000/stream/4/" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "http://christmas.allchristmashitsradio.com:8000/stream/4/" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "http://streaming.asliveaudio.net:8000/stream/?sid=1231" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "http://streaming.asliveaudio.net:8000/stream/?sid=1231" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "http://kea.cdnstream.com/1837_128" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "http://kea.cdnstream.com/1837_128" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "http://xmas.cdnstream.com/xmas128" }}'
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "http://xmas.cdnstream.com/xmas128" }}'
  action:
#Living room window
    - service: light.turn_on
      data: 
        entity_id: light.living_room_window_light
        rgb_color: [255,191,88]
        brightness: 220
        transition: 10
#Guest room window
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1_3
        rgb_color: [255,191,88]
        brightness: 220
        transition: 10
#Kitchen window
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1
        rgb_color: [255,43,0]
        brightness: 179
        transition: 10
#Bedroom window
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1_4
        rgb_color: [255,43,0]
        brightness: 179
        transition: 10
#right sofa
#    - service: light.turn_on
#      data: 
#        entity_id: light.hue_color_candle_1_2
#        rgb_color: [69,255,65]
#        brightness: 60
#        transition: 10
#right sofa 
    - service: light.turn_off
      data: 
        entity_id: light.hue_color_candle_1_2
#Left sofa
    - service: light.turn_on
      data: 
        entity_id: light.hue_go_1
        rgb_color: [255,191,88]
        brightness: 179
        transition: 10
#Bookshelf
    - service: light.turn_on
      data: 
        entity_id: light.bookshelf_color
        rgb_color: [255,43,48]
        brightness: 60
        transition: 10
#bookshelf
    - service: light.turn_on
      data: 
        entity_id: light.hue_color_candle_1_5
        rgb_color: [64,0,255]
        brightness: 60
        transition: 10
#Bookshelf
    - service: light.turn_on
      data: 
        entity_id: light.book_shelf_color_two
        rgb_color: [81,255,119]
        brightness: 60
        transition: 10
#Left power
    - service: light.turn_on
      data: 
        entity_id: light.onoff_plug_3
#right power
    - service: light.turn_on
      data: 
        entity_id: light.onoff_plug_2

- alias: "pop_song"
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: media_player.all,media_player.spa
    to: 'playing'
  condition:
    condition: or
    conditions:
      - condition: template
        value_template: '{{ states.media_player.spa.attributes.media_content_id == "http://stream.ueteknik.se:8000/poporock" }}'
      - condition: template
        value_template: '{{ states.media_player.all.attributes.media_content_id == "http://stream.ueteknik.se:8000/poporock" }}'
  action:
    - service: script.turn_on
      data: 
        entity_id: script.moodlight
#        rgb_color: [255,0,67]
#        brightness: 179
#        transition: 10
#        period: 40
#        cycles: 100
#        mode: breathe
#        effect: colorloop
#Valid modes: blink (default), breathe , ping , strobe , solid .

- alias: 'twinkly_on'
  initial_state: 'on'
  trigger:
    - platform: time
      at: '17:00:00'
    - platform: state
      entity_id: input_select.house_mode
      to: 'Home'
  condition:
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'
  - condition: time
    after: '17:00'
    before: '21:45'
  - condition: state
    entity_id: switch.xmas
    state: 'on'
  action:
    - service: homeassistant.turn_on
      entity_id: switch.twinkly

- alias: 'twinkly_off'
  initial_state: 'on'
  trigger:
  - platform: time
    at: '21:45:00'
  condition:
  - condition: state
    entity_id: switch.party
    state: 'off'
  action:
    - service: homeassistant.turn_off
      data: 
        entity_id: switch.twinkly

- alias: 'xmas'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.twinkly
    to: 'on'
  condition:
#  - condition: state
#    entity_id: input_select.status_hemma
#    state: 'Home'
  - condition: state
    entity_id: switch.xmas
    state: 'on'
  - condition: state
    entity_id: switch.party
    state: 'off'
  action:
    - service: script.turn_on
      data: 
        entity_id: script.xmas_lights_on

- alias: 'xmas_off'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.twinkly
    to: 'off'
  condition:
  - condition: state
    entity_id: switch.party
    state: 'off'
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'
  action:
    - service: script.turn_on
      data: 
        entity_id: script.xmas_lights_night


#######################################
#                                     #
#      Fönster                        #
#                                     #
#######################################

#######################################
#                                     #
#       Släck när vi inte är hemma    #
#                                     #
#######################################

#allt av
#- alias: "Allt av"
#  initial_state: 'on'
#  trigger:
#  - platform: time
#    at: '22:10:00'
#  action:
#  - service: scene.turn_on
#    data:
#     entity_id: scene.all_off
#######
#sovrummet fönster
#######

#######
#sovrummet
#######

#######
#sovrummet vägg
#######

#######
#hallen
#######

#######
#köket
#######


#######
#vardagsrummet
#######

#######
#vardagsrum fönster
#######

#######
#vardagsrummet
#######

#######
#vardagsrum bokhylla
#######

#######
#guest room
#######


#######################################
#                                     #
#       Godnatt & Godmorgon           #
#                                     #
#######################################
#läggdagslidija vardagar
- alias: 'Bedtime Lidija'
  initial_state: 'on'
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.fading_time.state }}'
  condition:
  - condition: state
    entity_id: switch.party
    state: 'off'
  - condition: state
    entity_id: input_boolean.fadelight
    state: 'on'
  - condition: state
    entity_id: input_boolean.alarmweekday_lidija
    state: 'on'
  - condition: state
    entity_id: input_select.status_hemma
    state: 'Home'
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  action:
  - service: script.turn_on
    entity_id: script.sleep

#######################################
#                                     #
#       Temperatur                    #
#                                     #
#######################################
- alias: 'Kallt i lägenheten'
  initial_state: 'on'
  trigger:
    platform: numeric_state
    entity_id: sensor.medel_temperatur
    below: 16
  condition:
    - condition: state
      entity_id: input_select.house_mode
      state: 'Away'
  action:
    service: notify.push
    data_template:
      title: Kallt i lägenheten
      message: Nu är det kallt

#######################################
#                                     #
#       Motion                        #
#                                     #
#######################################
- alias: 'Friday 13'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  condition:
  - condition: time
    weekday:
    - fri
  - condition: template
    value_template: '{{ now().weekday() == 4 and now().day == 13 }}'
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id: media_player.hallway
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: script.friday13
- alias: 'Alarm när vi inte är hemma'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  - platform: state
    entity_id: sensor.kitchen_motion_motion_sensor
    to: 'on'
  - platform: state
    entity_id: sensor.guest_room_motion_sensor
    to: 'on'
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: alarm_control_panel.ha_alarm
        state: 'armed_away'
      - condition: state
        entity_id: input_select.house_mode
        state: 'Away'
  action:
  - service: notify.push
    data_template:
      title: 'Alert'
      message:  'Larmet går! Tjuvar i lägenheten'
      
- alias: 'Welcome hallway'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - sat
    - sun
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id: media_player.hallway
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: 
      - script.hallway

- alias: 'Welcome hallway 2'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  condition:
  - condition: time
    weekday:
    - fri
  - condition: template
    value_template: '{{ now().weekday() == 4 and now().day != 13 }}'
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id: media_player.hallway
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: 
      - script.hallway

- alias: 'welcome guest'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.guest_room_motion_sensor
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: 
      - script.guest_room

- alias: 'Welcome kitchen'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.kitchen_motion_motion_sensor
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.kitchen_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.hallway_tts
    state: 'off'
  - condition: state
    entity_id: input_boolean.guest_tts
    state: 'off'
  - condition: state
    entity_id: media_player.kitchen
    state: 'off'
  - condition: state
    entity_id: media_player.all
    state: 'off'
  - condition: state
    entity_id: media_player.spa
    state: 'off'
  action:
  - service: script.turn_on
    entity_id: 
      - script.kitchen

- alias: 'Enable speak in kitchen'
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_kitchen_tts
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.kitchen_tts

- alias: 'Enable speak in guest room'
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_guest_tts
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.guest_tts

- alias: 'Enable speak in hallway'
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_hallway_tts
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.hallway_tts
#- alias: 'turn on light in entry hall when motion'
#  initial_state: 'on'
#  trigger:
#  - platform: state
#    entity_id: sensor.hallway_motion_sensor
#    to: 'on'
#  condition:
#      - condition: template
#        value_template: "{{ states.sensor.period_of_day.state != 'night' }}"
#  action:
#  - service: light.turn_on
#    entity_id: light.onoff_plug_1
#
#- alias: 'turn off light in entry hall when no motion'
#  initial_state: 'on'
#  initial_state: 'on'
#  trigger:
#    platform: state
#    entity_id: sensor.hallway_motion_sensor
#    to: 'off'
#    for:
#      minutes: 5
#  action:
#    service: light.turn_off
#    entity_id: light.onoff_plug_1
#######################################
#                                     #
#       Media                         #
#                                     #
#######################################
- alias: 'something playing'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: media_player.bedroom, media_player.chromecast_audio, media_player.hallway, media_player.kitchen, media_player.living_room_left, media_player.living_room_speaker, media_player.living_room_right, media_player.jbllink104191, media_player.all, media_player.spa
    to: 'playing'
  # condition:
  #   condition: or
  #   conditions:
  #     - condition: state
  #       entity_id: media_player.bedroom
  #       state: 'playing'
  #     - condition: state
  #       entity_id: media_player.chromecast_audio
  #       state: 'playing'
  #     - condition: state
  #       entity_id: media_player.hallway
  #       state: 'playing'
  #     - condition: state
  #       entity_id: media_player.kitchen
  #       state: 'playing'
  #     - condition: state
  #       entity_id: media_player.living_room_left
  #       state: 'playing'
  #     - condition: state
  #       entity_id: media_player.living_room_speaker
  #       state: 'playing'
  #     - condition: state
  #       entity_id: media_player.living_room_right
  #       state: 'playing'
  #     - condition: state
  #       entity_id: media_player.jbllink104191
  #       state: 'playing'
  #     - condition: state
  #       entity_id: media_player.all
  #       state: 'playing'
  #     - condition: state
  #       entity_id: media_player.spa
  #       state: 'playing'
  action:
  - service: homeassistant.turn_on
    entity_id: 
      - input_boolean.audio_off

- alias: 'something stopped playing'
  initial_state: 'on'
  hide_entity: true
  trigger:
    platform: state
    entity_id: media_player.bedroom, media_player.chromecast_audio, media_player.hallway, media_player.kitchen, media_player.living_room_left, media_player.living_room_speaker, media_player.living_room_right, media_player.jbllink104191, media_player.all, media_player.spa
    to: 'off'
  condition:
      - condition: state
        entity_id: media_player.bedroom
        state: 'off'
      - condition: state
        entity_id: media_player.chromecast_audio
        state: 'off'
      - condition: state
        entity_id: media_player.hallway
        state: 'off'
      - condition: state
        entity_id: media_player.kitchen
        state: 'off'
      - condition: state
        entity_id: media_player.living_room_left
        state: 'off'
      - condition: state
        entity_id: media_player.living_room_speaker
        state: 'off'
      - condition: state
        entity_id: media_player.living_room_right
        state: 'off'
      - condition: state
        entity_id: media_player.jbllink104191
        state: 'off'
      - condition: state
        entity_id: media_player.all
        state: 'off'
      - condition: state
        entity_id: media_player.spa
        state: 'off'
  action:
  - service: homeassistant.turn_off
    entity_id: 
      - input_boolean.audio_off

#- alias: 'Announcement Movie state playing'
#   initial_state: 'on'
#   hide_entity: true
#   trigger:
#     platform: state
#     entity_id: media_player.chromecastultra6229
#     # you can leave this following line out if you want an announcement on every state change.
#     to: 'playing'
#   action:
#   - service: script.turn_on
#     entity_id: 
#       - script.media_playing

# - alias: 'Announcement Movie state paused'
#   initial_state: 'on'
#   hide_entity: true
#   trigger:
#     platform: state
#     entity_id: media_player.chromecastultra6229
#     # you can leave this following line out if you want an announcement on every state change.
#     to: 'paused'
#   action:
#   - service: script.turn_on
#     entity_id: 
#       - script.media_paused

# - alias: 'Announcement Movie state paused'
#   initial_state: 'on'
#   hide_entity: true
#   trigger:
#     platform: state
#     entity_id: media_player.chromecastultra6229
#     # you can leave this following line out if you want an announcement on every state change.
#     to: 'off'
#   action:
#   - service: script.turn_on
#     entity_id: 
#       - script.media_off

#casting
- alias: 'casting'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: media_player.chromecastultra6229
    to: 'playing'
  action:
  - service: script.turn_on
    entity_id: script.tv_hdmi2
  - delay: '00:00:01'
  - service: script.turn_on
    entity_id: script.denon_tv

- alias: 'Play Spotify'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.play_spotify
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.play_spotify
#tv/stereo
      
- alias: 'Volume kitchen'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_kitchen2
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.kitchen
      volume_level: '{{  states.input_number.spotify_volume_kitchen.state }}'
- alias: 'Volume Living room left'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_lr_l
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_left
      volume_level: '{{  states.input_number.spotify_volume_lr_l.state }}'
- alias: 'Volume Living room right'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_lr_r
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_right
      volume_level: '{{  states.input_number.spotify_volume_lr_r.state }}'
- alias: 'Volume Living room speaker'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_lr
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_speaker
      volume_level: '{{  states.input_number.spotify_volume_lr.state }}'
- alias: 'Volume Hallway'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_hallway
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.hallway
      volume_level: '{{  states.input_number.spotify_volume_hallway.state }}'
- alias: 'Volume Bedroom'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_bedroom
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.bedroom
      volume_level: '{{  states.input_number.spotify_volume_bedroom.state }}'   
- alias: 'Volume cca'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_cca
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.chromecast_audio
      volume_level: '{{  states.input_number.spotify_volume_cca.state }}'

- alias: 'Volume hub'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: media_player.living_room_display
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.living_room_display
      volume_level: '{{  states.input_number.spotify_volume_hub.state }}'

- alias: 'Volume Guest'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: media_player.jbllink104191
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.jbllink104191
      volume_level: '{{  states.input_number.spotify_volume_guest.state }}'

- alias: 'Volume Soundbar'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: media_player.chromecastaudio1108
  action:
    service: media_player.volume_set
    data_template:
      entity_id: media_player.chromecastaudio1108
      volume_level: '{{  states.input_number.spotify_volume_soundbar.state }}'
      
- alias: 'Volume All'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_all
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.chromecastaudio1108, media_player.kitchen, media_player.living_room_left, media_player.living_room_right, media_player.living_room_speaker, media_player.hallway, media_player.chromecast_audio, media_player.bedroom, media_player.living_room_display
      volume_level: '{{  states.input_number.spotify_volume_all.state }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.spotify_volume_soundbar, input_number.spotify_volume_kitchen, input_number.spotify_volume_hallway, input_number.spotify_volume_lr, input_number.spotify_volume_lr_r, input_number.spotify_volume_lr_l, input_number.spotify_volume_living_room, input_number.spotify_volume_music, input_number.spotify_volume_cca, input_number.spotify_volume_bedroom, input_number.spotify_volume_hub
      value: "{{ states.input_number.spotify_volume_all.state }}"
- alias: 'Volume Music'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_music
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.kitchen, media_player.living_room_left, media_player.living_room_right, media_player.living_room_speaker
      volume_level: '{{  states.input_number.spotify_volume_music.state }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.spotify_volume_kitchen, input_number.spotify_volume_hallway, input_number.spotify_volume_lr, input_number.spotify_volume_lr_r, input_number.spotify_volume_lr_l, input_number.spotify_volume_living_room
      value: "{{ states.input_number.spotify_volume_music.state }}"
- alias: 'Volume Livingroom'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_number.spotify_volume_living_room
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.chromecastaudio1108, media_player.living_room_left, media_player.living_room_right, media_player.living_room_speaker
      volume_level: '{{  states.input_number.spotify_volume_living_room.state }}'
  - service: input_number.set_value 
    data_template:
      entity_id: input_number.spotify_volume_soundbar, input_number.spotify_volume_lr, input_number.spotify_volume_lr_r, input_number.spotify_volume_lr_l
      value: "{{ states.input_number.spotify_volume_living_room.state }}"
#######################################
#                                     #
#       Kaffe                         # 
#                                     #
#######################################
- alias: 'kitchen plug'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: light.kaffe
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.coffee_on
#kaffetimer

#kaffe off automatic
- alias: Turn off perkulator at end of timer
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_perka
  action:
  - service: script.turn_on
    entity_id: script.coffee_off
  - delay:
      seconds: 2
  - service: script.turn_on
    entity_id: script.coffeedone
#vattenkokare on
- alias: 'Vattenkokare on'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.vattenkokare
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.vattenkokare_on
#vattenkokare on
- alias: 'Vattenkokare on'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.perka
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.coffee_on
#vattenkokare off automatic
- alias: Turn off vattenkokare at end of timer
  initial_state: 'on'
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_vattenkokare
  action:
  - service: script.turn_on
    entity_id: script.coffee_off

#######################################
#                                     #
#       Home or away                  #
#                                     #
#######################################

- alias: Turn off lights when away
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_select.house_mode
    to: 'Away'
    for:
      seconds: 1200
  condition:
  - condition: state
    entity_id: input_boolean.guests_present
    state: 'off'
  action:
    - delay:
        seconds: 600
    - service: light.turn_off
      data: 
        entity_id: group.all_actual_lights


- alias: Home Mode - Status Home
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_select.status_hemma
    to: 'Home'
  action:
  - service: switch.turn_on
    data: 
      entity_id: switch.status_hemma

- alias: Home Mode - Status Home 2
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.status_hemma
    to: 'on'
  action:
  - service: input_select.select_option
    entity_id: input_select.status_hemma
    data:
      option: 'Home'

- alias: Home Mode - Status Away
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_select.status_hemma
    to: 'Away'
  action:
  - service: switch.turn_off
    data: 
      entity_id: switch.status_hemma

- alias: Home Mode - Status Away 2
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: switch.status_hemma
    to: 'off'
  action:
  - service: input_select.select_option
    entity_id: input_select.status_hemma
    data:
      option: 'Away'

- alias: Home Mode - Away
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_select.house_mode
    to: 'Away'
  condition:
  - condition: state
    entity_id: input_boolean.guests_present
    state: 'off'
  action:
  - service: input_boolean.turn_off
    data: 
      entity_id: input_boolean.home
      
- alias: Home Mode - Home
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_select.house_mode
    to: 'Home'
  action:
  - service: input_boolean.turn_on
    data: 
      entity_id: input_boolean.home

- alias: Home Mode - Arriving
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id:
      - input_boolean.cg_present
      - input_boolean.lt_present
      - input_boolean.guests_present
    to: 'on'
  - platform: state
    entity_id:

#      - group.extra_device_trackers
    to: 'home'
  condition:
  - condition: numeric_state
    entity_id: sensor.ha_runtime_in_minutes
    above: 1
  action:
  - service: input_select.select_option
    entity_id: input_select.house_mode
    data:
      option: 'Home'
#morning check
- alias: 'morning_on'
  initial_state: 'on'
  trigger:
    - platform: time
      at: '06:30:00'
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: device_tracker.
        state: 'home'
      - condition: state
        entity_id: device_tracker.
        state: 'home'
      - condition: state
        entity_id: device_tracker.
        state: 'home'
      - condition: state
        entity_id: device_tracker.
        state: 'home'
  action:
  - service: input_select.select_option
    entity_id: input_select.house_mode
    data:
      option: 'Home'
#checking LT home
- alias: 'Hass Started checking LT home'
  initial_state: 'on'
  trigger:
  - platform: time
    hours: '/1'
    minutes: 0
    seconds: 0
  - platform: homeassistant
    event: start
  - platform: state
    entity_id:
      - switch.lt_present
    to: 'off'
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: device_tracker.
        state: 'home'
      - condition: state
        entity_id: device_tracker.
        state: 'home'
  action:
  - service: input_boolean.turn_on
    data: 
      entity_id: input_boolean.lt_present
  - service: switch.turn_on
    data: 
      entity_id: switch.lt_present
  - service: input_select.select_option
    entity_id: input_select.house_mode
    data:
      option: 'Home'
#LT arrives
- alias: Home Lidija - Arriving
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id:
      - device_tracker.
    to: 'home'
  - platform: state
    entity_id:
      - device_tracker.
    to: 'home'
  action:
  - service: input_boolean.turn_on
    data: 
      entity_id: input_boolean.lt_present
  - service: switch.turn_on
    data: 
      entity_id: switch.lt_present
  - service: script.turn_on
    entity_id: script.lidija_home
  - service: input_select.select_option
    entity_id: input_select.house_mode
    data:
      option: 'Home'
#checking if LT is home
- alias: 'Hass Started checking LT home'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    event: start
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: device_tracker.
        state: 'not_home'
      - condition: state
        entity_id: device_tracker.
        state: 'not_home'
  action:
  - service: input_boolean.turn_off
    data: 
      entity_id: input_boolean.lt_present
  - service: switch.turn_off
    data: 
      entity_id: switch.lt_present
#checking if CG is away
- alias: Home Christer - check away
  initial_state: 'on'
  trigger:
  - platform: time
    hours: '/1'
    minutes: 0
    seconds: 0
  - platform: state
    entity_id:
      - switch.cg_present
    to: 'off'
  - platform: homeassistant
    event: start
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: device_tracker.
        state: 'home'
      - condition: state
        entity_id: device_tracker.
        state: 'home'
  action:
  - service: input_boolean.turn_on
    data: 
      entity_id: input_boolean.cg_present
  - service: switch.turn_on
    data: 
      entity_id: switch.cg_present
  - service: input_select.select_option
    entity_id: input_select.house_mode
    data:
      option: 'Home'
#checking if CG is home
- alias: 'Hass Started checking CG home 2'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    event: start
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: device_tracker.
        state: 'not_home'
      - condition: state
        entity_id: device_tracker.
        state: 'not_home'
  action:
  - service: input_boolean.turn_off
    data: 
      entity_id: input_boolean.cg_present
  - service: switch.turn_off
    data: 
      entity_id: switch.cg_present
#CG arrives
- alias: Home Christer - Arriving
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id:
      - device_tracker.
    to: 'home'
  - platform: state
    entity_id:
      - device_tracker.
    to: 'home'
  action:
  - service: input_boolean.turn_on
    data: 
      entity_id: input_boolean.cg_present
  - service: switch.turn_on
    data: 
      entity_id: switch.cg_present
  - service: input_select.select_option
    entity_id: input_select.house_mode
    data:
      option: 'Home'
#LT leaving
- alias: Home Lidija - Leaving 2
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: device_tracker.
    to: 'not_home'
    for:
      seconds: 180
  - platform: state
    entity_id: device_tracker.
    to: 'not_home'
    for:
      seconds: 180
  condition:
  - condition: numeric_state
    entity_id: sensor.ha_runtime_in_minutes
    above: 1
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'
  action:
  - service: input_boolean.turn_off
    data: 
      entity_id: input_boolean.lt_present
  - service: switch.turn_off
    data: 
      entity_id: switch.lt_present
  - service: script.turn_on
    data: 
      entity_id: script.home_or_not
#CG leaving
- alias: Home Christer - Leaving 
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: device_tracker.
    to: 'not_home'
    for:
      seconds: 180
  - platform: state
    entity_id: device_tracker.
    to: 'not_home'
    for:
      seconds: 180
  condition:
  - condition: numeric_state
    entity_id: sensor.ha_runtime_in_minutes
    above: 1
  - condition: state
    entity_id: input_select.house_mode
    state: 'Home'
  action:
  - service: input_boolean.turn_off
    data: 
      entity_id: input_boolean.cg_present
  - service: switch.turn_off
    data: 
      entity_id: switch.cg_present
  - service: script.turn_on
    data: 
      entity_id: script.home_or_not
#Motion CG presence
- alias: 'Motion CG presence'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.kitchen_motion_motion_sensor
    to: 'on'
  - platform: state
    entity_id: sensor.guest_room_motion_sensor
    to: 'on'
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: device_tracker.
      state: 'home'
    - condition: state
      entity_id: device_tracker.
      state: 'home'
  action:
  - service: input_boolean.turn_on
    data: 
      entity_id: input_boolean.cg_present
  - service: switch.turn_on
    data: 
      entity_id: switch.cg_present
  - service: input_select.select_option
    entity_id: input_select.house_mode
    data:
      option: 'Home'
#Motion LT presence
- alias: 'Motion LT presence'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: sensor.hallway_motion_sensor
    to: 'on'
  - platform: state
    entity_id: sensor.guest_room_motion_sensor
    to: 'on'
  - platform: state
    entity_id: sensor.kitchen_motion_motion_sensor
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: device_tracker.
      state: 'home'
    - condition: state
      entity_id: device_tracker.
      state: 'home'
  action:
  - service: input_boolean.turn_on
    data: 
      entity_id: input_boolean.lt_present
  - service: switch.turn_on
    data: 
      entity_id: switch.lt_present
  - service: input_select.select_option
    entity_id: input_select.house_mode
    data:
      option: 'Home'
#Home to home
- alias: 'home to home'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.home
    to: 'on'
  action:
  - service: switch.turn_on
    data: 
      entity_id: switch.home
#Home to away
- alias: 'home to away'
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id: input_boolean.home
    to: 'off'
  action:
  - service: switch.turn_off
    data: 
      entity_id: switch.home
